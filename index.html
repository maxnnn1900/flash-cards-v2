<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–ª–µ—à-–∫–∞—Ä—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <style>
        /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∏–ª–∏ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        code {
            font-family: 'Fira Code', 'Cascadia Code', 'Consolas', 'Monaco', 'Andale Mono', 'Ubuntu Mono', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 text-sm md:text-base">
    <div id="app" class="container mx-auto p-1 md:p-4">
        <h1 class="text-2xl md:text-4xl font-extrabold text-center my-2 md:my-8 text-gray-900">–§–ª–µ—à-–∫–∞—Ä—Ç—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è</h1>

        <div class="mb-2 md:mb-8">
            <nav class="flex justify-center space-x-1 md:space-x-4 mb-1 md:mb-4">
                <button @click="currentView = 'load'" :class="{'bg-green-500 text-white': currentView === 'load', 'bg-blue-500 text-white': currentView !== 'load'}" class="px-2 py-1 rounded-md text-sm font-semibold hover:opacity-90 transition-opacity duration-200">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–¥—ã</button>
                <button @click="currentView = 'learn'" :class="{'bg-green-500 text-white': currentView === 'learn', 'bg-blue-500 text-white': currentView !== 'learn'}" class="px-2 py-1 rounded-md text-sm font-semibold hover:opacity-90 transition-opacity duration-200">–ò–∑—É—á–µ–Ω–∏–µ</button>
                <button @click="currentView = 'manage'" :class="{'bg-green-500 text-white': currentView === 'manage', 'bg-blue-500 text-white': currentView !== 'manage'}" class="px-2 py-1 rounded-md text-sm font-semibold hover:opacity-90 transition-opacity duration-200">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥–∞–º–∏</button>
            </nav>
        </div>

        <div v-if="currentView === 'load'" class="bg-white p-1 md:p-6 rounded-lg shadow-md">
            <h2 class="text-xl md:text-3xl font-bold mb-2 md:mb-6 text-gray-800">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ–π –∫–æ–ª–æ–¥—ã</h2>
            <textarea
                v-model="newDeckInput"
                class="w-full p-1 md:p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm md:text-lg"
                rows="10"
                placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
Q.
–í–æ–ø—Ä–æ—Å 1
A.
–û—Ç–≤–µ—Ç 1
---
Q.
–í–æ–ø—Ä–æ—Å 2
A.
–û—Ç–≤–µ—Ç 2 —Å –∫–æ–¥–æ–º:
```javascript
console.log('Hello, world!');
```"
            ></textarea>
            <p class="text-sm text-gray-600 mt-2">
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `Q.` –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞, `A.` –¥–ª—è –æ—Ç–≤–µ—Ç–∞. –†–∞–∑–¥–µ–ª—è–π—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ `---`. –î–ª—è –±–ª–æ–∫–æ–≤ –∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç—Ä–æ–π–Ω—ã–µ –±—ç–∫—Ç–∏–∫–∏ (\`\`\`).
            </p>
            <button @click="loadDeck" class="mt-2 md:mt-6 w-full bg-green-600 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-green-700 transition-colors duration-200">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–ª–æ–¥—É</button>
            <p v-if="loadMessage" :class="{'text-green-600': loadMessageType === 'success', 'text-red-600': loadMessageType === 'error'}" class="mt-2 text-center text-base md:text-lg">{{ loadMessage }}</p>
        </div>

        <div v-if="currentView === 'learn'" class="bg-white p-1 md:p-8 rounded-lg shadow-md">
            <h2 class="text-xl md:text-3xl font-bold mb-2 md:mb-6 text-gray-800">–ò–∑—É—á–µ–Ω–∏–µ –∫–æ–ª–æ–¥—ã: {{ currentDeck ? currentDeck.name : '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–¥—ã' }}</h2>

            <div v-if="currentDeck && currentDeck.cards.length > 0">
                <div v-if="currentCard" class="bg-gray-50 p-2 md:p-6 rounded-lg shadow-inner mb-2 md:mb-6 relative">
                    <button @click="deleteCurrentCard" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 text-2xl transition-colors duration-200" title="–£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É">
                        üóëÔ∏è
                    </button>
                    <p class="text-lg md:text-2xl font-semibold mb-1 md:mb-4 text-gray-900">Q: {{ currentCard.question }}</p>
                    <div v-if="showAnswer" class="mt-4 border-t border-gray-200 pt-4">
                        <p class="text-base md:text-xl font-semibold mb-1 md:mb-2 text-gray-800">A:</p>
                        <div v-html="highlightedAnswer" class="prose max-w-none mb-4"></div>
                        <p class="text-sm text-gray-600">–í–µ—Å –∫–∞—Ä—Ç–æ—á–∫–∏: {{ currentCard.weight.toFixed(2) }} | –ü–æ–∫–∞–∑–æ–≤: {{ currentCard.attempts }}</p>
                    </div>
                </div>
                <div v-else class="text-center text-gray-600 text-base md:text-xl py-2 md:py-10">
                    –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —ç—Ç–æ–π –∫–æ–ª–æ–¥–µ –∏–∑—É—á–µ–Ω—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥—É—é –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—É—é.
                </div>

                <div v-if="currentCard">
                    <div v-if="!cardRated" class="flex justify-around mt-2 md:mt-6 space-x-2 md:space-x-4">
                        <button @click="rateCard('forgot')" class="flex-1 bg-red-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-red-600 transition-colors duration-200">–ó–∞–±—ã–ª</button>
                        <button @click="rateCard('remember')" class="flex-1 bg-yellow-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-yellow-600 transition-colors duration-200">–ü—Ä–∏–ø–æ–º–∏–Ω–∞—é</button>
                        <button @click="rateCard('know')" class="flex-1 bg-green-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-green-600 transition-colors duration-200">–ó–Ω–∞—é</button>
                    </div>
                    <div v-else class="flex justify-center mt-2 md:mt-6 space-x-2 md:space-x-4">
                        <button @click="getNextCard" class="bg-blue-500 text-white px-3 py-1 rounded-md text-sm font-semibold hover:bg-blue-600 transition-colors duration-200">–°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞</button>
                    </div>
                </div>
            </div>
            <div v-else class="text-center text-gray-600 text-base md:text-xl py-2 md:py-10">
                <p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–¥—ã –∏–ª–∏ –æ–Ω–∞ –ø—É—Å—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–ª–æ–¥—É –Ω–∞ –≤–∫–ª–∞–¥–∫–µ "–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–ª–æ–¥—ã".</p>
            </div>
        </div>

        <div v-if="currentView === 'manage'" class="bg-white p-1 md:p-8 rounded-lg shadow-md">
            <h2 class="text-xl md:text-3xl font-bold mb-2 md:mb-6 text-gray-800">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–æ–¥–∞–º–∏</h2>
            <div v-if="decks.length > 0">
                <ul class="space-y-1 md:space-y-4">
                    <li v-for="deck in decks" :key="deck.id" class="flex flex-col md:flex-row items-start md:items-center justify-between p-1 md:p-5 border border-gray-200 rounded-lg bg-gray-50 shadow-sm">
                        <div class="flex-grow mb-1 md:mb-0">
                            <span class="font-semibold text-lg md:text-xl text-gray-900">{{ deck.name }}</span>
                            <p class="text-sm text-gray-500 mt-1">–°–æ–∑–¥–∞–Ω–∞: {{ new Date(deck.createdAt).toLocaleString() }}</p>
                            <p class="text-sm text-gray-500">–ö–∞—Ä—Ç–æ—á–µ–∫: {{ deck.cards.length }}</p>
                        </div>
                        <div class="flex flex-wrap gap-1 md:gap-4 justify-end">
                            <button @click="loadSavedDeck(deck.id)" class="bg-green-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-green-600 transition-colors duration-200">–ò–∑—É—á–∏—Ç—å</button>
                            <button @click="startRenameDeck(deck)" class="bg-blue-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-blue-600 transition-colors duration-200">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                            <button @click="resetDeckProgress(deck.id)" class="bg-purple-600 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-purple-700 transition-colors duration-200">–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å</button>
                            <button @click="deleteDeck(deck.id)" class="bg-red-500 text-white px-2 py-1 rounded-md text-sm font-semibold hover:bg-red-600 transition-colors duration-200">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </li>
                </ul>
            </div>
            <div v-else class="text-center text-gray-600 text-base md:text-xl py-2 md:py-10">
                –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–æ–ª–æ–¥.
            </div>

            <div v-if="isRenaming" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 md:p-4">
                <div class="bg-white p-1 md:p-8 rounded-lg shadow-xl w-full max-w-md">
                    <h3 class="text-lg md:text-2xl font-bold mb-2 md:mb-5 text-gray-800">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –∫–æ–ª–æ–¥—É</h3>
                    <input
                        type="text"
                        v-model="newDeckName"
                        @keyup.enter="renameDeck"
                        class="w-full p-1 md:p-3 border border-gray-300 rounded-lg mb-2 md:mb-5 text-sm md:text-lg focus:outline-none focus:ring-2 focus:ring-blue-400"
                        placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ"
                    >
                    <div class="flex justify-end space-x-3">
                        <button @click="isRenaming = false" class="px-2 py-1 bg-gray-300 rounded-md text-sm font-semibold text-gray-800 hover:bg-gray-400 transition-colors duration-200">–û—Ç–º–µ–Ω–∞</button>
                        <button @click="renameDeck" class="px-2 py-1 bg-green-500 text-white rounded-md text-sm font-semibold hover:bg-green-600 transition-colors duration-200">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        new Vue({
            el: '#app',
            data: {
                currentView: 'load', // 'load', 'learn', 'manage'
                newDeckInput: '',
                loadMessage: '',
                loadMessageType: '',
                decks: [],
                currentDeck: null,
                currentCard: null,
                showAnswer: false, // Controls whether answer is visible
                isRenaming: false,
                deckToRename: null,
                newDeckName: '',
                cardRated: false // –§–ª–∞–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –±—ã–ª–∞ –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –æ—Ü–µ–Ω–µ–Ω–∞
            },
            computed: {
                highlightedAnswer() {
                    if (!this.currentCard || !this.showAnswer) return '';

                    let processedAnswer = this.currentCard.answer.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');

                    const codeBlockRegex = /```(\w+)?\n([\s\S]*?)\n```/g;

                    processedAnswer = processedAnswer.replace(codeBlockRegex, (match, lang, code) => {
                        const languageClass = lang ? `language-${lang.toLowerCase()}` : '';
                        return `<pre class="p-2 md:p-4 text-xs md:text-sm rounded-lg overflow-auto" style="background-color:#282c34"><code class="${languageClass}">${code}</code></pre>`;
                    });

                    const parts = processedAnswer.split(/(<pre[\s\S]*?<\/pre>)/);
                    let finalHtml = '';
                    parts.forEach(part => {
                        if (part.startsWith('<pre') && part.endsWith('</pre>')) {
                            finalHtml += part;
                        } else {
                            finalHtml += part.replace(/\n/g, '<br>');
                        }
                    });

                    return finalHtml;
                }
            },
            methods: {
                generateUUID() {
                    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                },

                loadDeck() {
                    if (!this.newDeckInput.trim()) {
                        this.loadMessage = '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏.';
                        this.loadMessageType = 'error';
                        return;
                    }

                    const rawCards = this.newDeckInput.split('---').map(card => card.trim()).filter(card => card);
                    const parsedCards = [];

                    for (const rawCard of rawCards) {
                        const lines = rawCard.split('\n');
                        let question = '';
                        let answer = '';
                        let isQuestionSection = false;
                        let isAnswerSection = false;
                        let inCodeBlock = false;

                        for (let i = 0; i < lines.length; i++) {
                            const line = lines[i];
                            const trimmedLine = line.trim();

                            if (trimmedLine.startsWith('Q.')) {
                                question = trimmedLine.substring(2).trim();
                                isQuestionSection = true;
                                isAnswerSection = false;
                                inCodeBlock = false;
                            } else if (trimmedLine.startsWith('A.')) {
                                answer = trimmedLine.substring(2).trim();
                                isAnswerSection = true;
                                isQuestionSection = false;
                                inCodeBlock = false;
                            } else if (trimmedLine.startsWith('```')) {
                                inCodeBlock = !inCodeBlock;
                                answer += (answer ? '\n' : '') + line;
                            } else if (isQuestionSection) {
                                question += '\n' + line;
                            } else if (isAnswerSection) {
                                answer += (answer ? '\n' : '') + line;
                            }
                        }

                        if (question && answer) {
                            parsedCards.push({
                                id: this.generateUUID(),
                                question: question.trim(),
                                answer: answer.trim(),
                                weight: 1, // –ù–∞—á–∞–ª—å–Ω—ã–π –≤–µ—Å
                                attempts: 0 // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤
                            });
                        }
                    }

                    if (parsedCards.length === 0) {
                        this.loadMessage = '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å –Ω–∏ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç.';
                        this.loadMessageType = 'error';
                        return;
                    }

                    const newDeck = {
                        id: this.generateUUID(),
                        name: `–ö–æ–ª–æ–¥–∞ –æ—Ç ${new Date().toLocaleString('ru-RU', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}`,
                        createdAt: new Date().toISOString(),
                        cards: parsedCards
                    };

                    this.decks.push(newDeck);
                    this.saveDecks();
                    this.currentDeck = newDeck;
                    this.newDeckInput = '';
                    this.loadMessage = `–ö–æ–ª–æ–¥–∞ "${newDeck.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ (${parsedCards.length} –∫–∞—Ä—Ç–æ—á–µ–∫)!`;
                    this.loadMessageType = 'success';
                    this.currentView = 'learn';
                    this.getNextCard();
                },

                saveDecks() {
                    localStorage.setItem('flashcards_decks', JSON.stringify(this.decks));
                },

                loadDecks() {
                    const savedDecks = localStorage.getItem('flashcards_decks');
                    if (savedDecks) {
                        this.decks = JSON.parse(savedDecks);
                        this.decks.forEach(deck => {
                            deck.cards.forEach(card => {
                                if (typeof card.attempts === 'undefined') {
                                    card.attempts = 0;
                                }
                                if (typeof card.weight === 'undefined' || isNaN(card.weight)) {
                                    card.weight = 1;
                                }
                            });
                        });
                    }
                },

                getNextCard() {
                    if (!this.currentDeck || this.currentDeck.cards.length === 0) {
                        this.currentCard = null;
                        this.showAnswer = false;
                        this.cardRated = false; // –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
                        return;
                    }

                    // –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –≤–µ—Å–æ–º < 0.05 —Å—á–∏—Ç–∞–µ–º "–∏–∑—É—á–µ–Ω–Ω—ã–º–∏" (–æ—á–µ–Ω—å —Ä–µ–¥–∫–æ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è)
                    const availableCards = this.currentDeck.cards.filter(card => card.weight > 0.05);

                    if (availableCards.length === 0) {
                        this.currentCard = null;
                        this.showAnswer = false;
                        this.cardRated = false; // –°–±—Ä–æ—Å —Ñ–ª–∞–≥–∞
                        return;
                    }

                    const totalWeight = availableCards.reduce((sum, card) => sum + card.weight, 0);
                    let randomPoint = Math.random() * totalWeight;

                    for (let i = 0; i < availableCards.length; i++) {
                        randomPoint -= availableCards[i].weight;
                        if (randomPoint <= 0) {
                            this.currentCard = availableCards[i];
                            this.currentCard.attempts = (this.currentCard.attempts || 0) + 1; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –ø–æ–∫–∞–∑–æ–≤
                            this.showAnswer = false; // –°–∫—Ä—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç –¥–ª—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
                            this.cardRated = false; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –æ—Ü–µ–Ω–∫–∏, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏
                            this.saveDecks(); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–µ attempts
                            return;
                        }
                    }
                    // Fallback (–¥–æ–ª–∂–µ–Ω —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫—Ä–∞–π–Ω–µ —Ä–µ–¥–∫–æ)
                    this.currentCard = availableCards[0];
                    this.currentCard.attempts = (this.currentCard.attempts || 0) + 1;
                    this.showAnswer = false;
                    this.cardRated = false;
                    this.saveDecks();
                },

                rateCard(rating) {
                    if (!this.currentCard || !this.currentDeck) return;

                    // –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –µ—â–µ –Ω–µ –ø–æ–∫–∞–∑–∞–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –µ–≥–æ
                    if (!this.showAnswer) {
                        this.showAnswer = true;
                        this.$nextTick(() => {
                            document.querySelectorAll('pre code').forEach(block => {
                                hljs.highlightElement(block);
                            });
                        });
                        // –ü–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–∞, —Å—Ä–∞–∑—É –ø—Ä–∏–º–µ–Ω—è–µ–º –ª–æ–≥–∏–∫—É –≤–µ—Å–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cardRated
                        this.applyWeightChange(rating);
                        this.saveDecks();
                        this.cardRated = true; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å "–°–ª–µ–¥—É—é—â–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞"
                        return;
                    }
                },

                applyWeightChange(rating) {
                    // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–∫–∞–∑–∞ –æ—Ç–≤–µ—Ç–∞
                    switch (rating) {
                        case 'know':
                            this.currentCard.weight *= 0.4; // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º –≤–µ—Å
                            break;
                        case 'remember':
                            this.currentCard.weight *= 1.0; // –í–µ—Å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
                            break;
                        case 'forgot':
                            this.currentCard.weight = Math.min(this.currentCard.weight * 2.0 + 0.5, 10); // –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≤–µ—Å, –º–∞–∫—Å–∏–º—É–º –¥–æ 10
                            break;
                    }
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–µ—Å
                    this.currentCard.weight = Math.max(0.01, this.currentCard.weight); // –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å, —á—Ç–æ–±—ã –Ω–µ –∏—Å—á–µ–∑–ª–∞ —Å–æ–≤—Å–µ–º
                },

                deleteCurrentCard() {
                    if (!this.currentDeck || !this.currentCard) return;

                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–∞—Ä—Ç–æ—á–∫—É –∏–∑ —Ç–µ–∫—É—â–µ–π –∫–æ–ª–æ–¥—ã?')) {
                        const cardIndex = this.currentDeck.cards.findIndex(card => card.id === this.currentCard.id);
                        if (cardIndex !== -1) {
                            this.currentDeck.cards.splice(cardIndex, 1);
                            this.saveDecks();
                            this.getNextCard();
                            alert('–ö–∞—Ä—Ç–æ—á–∫–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.');
                        } else {
                            alert('–û—à–∏–±–∫–∞: –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–ª–æ–¥–µ.');
                        }
                    }
                },

                loadSavedDeck(deckId) {
                    const deck = this.decks.find(d => d.id === deckId);
                    if (deck) {
                        this.currentDeck = deck;
                        this.currentView = 'learn';
                        this.getNextCard();
                        this.loadMessage = `–ö–æ–ª–æ–¥–∞ "${deck.name}" –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è.`;
                        this.loadMessageType = 'success';
                    }
                },

                startRenameDeck(deck) {
                    this.deckToRename = deck;
                    this.newDeckName = deck.name;
                    this.isRenaming = true;
                },

                renameDeck() {
                    if (this.deckToRename && this.newDeckName.trim()) {
                        this.deckToRename.name = this.newDeckName.trim();
                        this.saveDecks();
                        this.isRenaming = false;
                        this.deckToRename = null;
                        this.newDeckName = '';
                    } else {
                        alert('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–æ–¥—ã –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.');
                    }
                },

                resetDeckProgress(deckId) {
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–ª—è —ç—Ç–æ–π –∫–æ–ª–æ–¥—ã? –í—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–µ—Ä–Ω—É—Ç—Å—è –∫ –Ω–∞—á–∞–ª—å–Ω–æ–º—É –≤–µ—Å—É –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–∞–∑–æ–≤ –æ–±–Ω—É–ª–∏—Ç—Å—è.')) {
                        const deck = this.decks.find(d => d.id === deckId);
                        if (deck) {
                            deck.cards.forEach(card => {
                                card.weight = 1;
                                card.attempts = 0;
                            });
                            this.saveDecks();
                            if (this.currentDeck && this.currentDeck.id === deckId) {
                                this.getNextCard(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞
                            }
                            alert('–ü—Ä–æ–≥—Ä–µ—Å—Å –∫–æ–ª–æ–¥—ã —Å–±—Ä–æ—à–µ–Ω.');
                        }
                    }
                },

                deleteDeck(deckId) {
                    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–æ–ª–æ–¥—É –ø–æ–ª–Ω–æ—Å—Ç—å—é?')) {
                        this.decks = this.decks.filter(deck => deck.id !== deckId);
                        this.saveDecks();
                        if (this.currentDeck && this.currentDeck.id === deckId) {
                            this.currentDeck = null;
                            this.currentCard = null;
                            this.currentView = 'manage';
                        }
                        alert('–ö–æ–ª–æ–¥–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞.');
                    }
                }
            },
            created() {
                this.loadDecks();
                if (this.decks.length > 0) {
                    this.currentDeck = this.decks[0];
                    this.getNextCard();
                    this.currentView = 'learn';
                } else {
                    this.currentView = 'load';
                }
            }
        });
    </script>
</body>
</html>
